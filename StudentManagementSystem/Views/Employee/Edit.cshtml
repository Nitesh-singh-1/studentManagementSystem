@using EmployeeManagementSystem.Models
@model EmployeeResponse

@{
    ViewBag.Title = "Edit Employee";
}
@{
    
    var userId = Context.Session.GetInt32("UserId") ?? 0;
}

<div class="container py-4">
    <h2 class="fw-bold mb-1" style="color: var(--text-color); text-align:center;">
        Edit Employee Details
    </h2>
    <div class="text-start mb-4">
        <a asp-controller="Report" asp-action="Index" class="text-decoration-none" style="color: var(--primary-color); font-weight: 500;">
            ← Back to List
        </a>
    </div>

    <!-- ===================== -->
    <!-- EMPLOYEE UPDATE FORM -->
    <!-- ===================== -->
    <form asp-action="Edit" method="post" enctype="multipart/form-data" class="p-4 shadow-sm border-0 bg-white bg-opacity-75">
        <input type="hidden" asp-for="Id" />
        <input type="hidden" value="@userId" asp-for="modifiedBy" />
        <div class="row mb-3">
            <div class="col-md-6">
                <label asp-for="employeeName" class="form-label">Col No.</label>
                <input asp-for="employeeName" class="form-control" placeholder="Enter name" />
                <span asp-validation-for="employeeName" class="text-danger"></span>
            </div>

            <div class="col-md-6">
                <label asp-for="department" class="form-label">File No</label>
                <input asp-for="department" class="form-control" placeholder="Enter department" />
                <span asp-validation-for="department" class="text-danger"></span>
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <label asp-for="designation" class="form-label">Part No</label>
                <input asp-for="designation" class="form-control" placeholder="Enter designation" />
                <span asp-validation-for="designation" class="text-danger"></span>
            </div>
             <div class="col-md-6">
                <label asp-for="subject" class="form-label">Subject</label>
                <input asp-for="subject" class="form-control" placeholder="Enter subject" />
                <span asp-validation-for="subject" class="text-danger"></span>
            </div>

            @* <div class="col-md-6">
                <label asp-for="age" class="form-label">Age</label>
                <input asp-for="age" class="form-control" type="number" placeholder="Enter age" />
                <span asp-validation-for="age" class="text-danger"></span>
            </div> *@
        </div>

        <div class="row mb-3">
          @*   <div class="col-md-6">
                <label asp-for="gender" class="form-label">Gender</label>
                <input asp-for="gender" class="form-control" placeholder="Enter gender" />
                <span asp-validation-for="gender" class="text-danger"></span>
            </div>
 *@
            <div class="col-md-6">
                <label asp-for="address" class="form-label">From Year</label>
                <input asp-for="address" class="form-control" rows="2" placeholder="Enter From Year"></input>
                <span asp-validation-for="address" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="ToYear" class="form-label">To Year</label>
                <input asp-for="ToYear" class="form-control" rows="2" placeholder="Enter To Year"></input>
                <span asp-validation-for="ToYear" class="text-danger"></span>
            </div>
        </div>

        <div class="mb-3">
            <label for="documents" class="form-label">Upload Documents (PDFs)</label>
            <input type="file" name="documents" id="documents" class="form-control" multiple accept=".pdf" />
        </div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary px-4 me-2">Update</button>
            <a asp-action="Index" class="btn btn-secondary px-4">Cancel</a>
        </div>
    </form>

    <!-- ===================== -->
    <!-- DOCUMENT LIST + DELETE -->
    <!-- ===================== -->
    @if (Model.employeeDocuments != null && Model.employeeDocuments.Any())
    {
        <div class="mt-5 text-center">
            <h5 class="fw-semibold mb-3" style="color: var(--text-color);">Uploaded Documents</h5>

            @if (Model.employeeDocuments != null && Model.employeeDocuments.Any())
            {
                <table class="table table-bordered table-striped w-75 mx-auto">
                    <thead class="table-light">
                        <tr>
                            <th>File Name</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var doc in Model.employeeDocuments)
                        {
                            <tr>
                                <td class="text-start align-middle">@doc.FileName</td>
                                <td class="text-center">
                                    @* @if (!string.IsNullOrEmpty(doc.FilePath))
                                    {
                                        <a href="@doc.FilePath" target="_blank" class="btn btn-sm btn-outline-primary me-2">
                                            <i class="fa-solid fa-eye"></i> View
                                        </a>
                                    }
                                    else
                                    {
                                        <span class="text-muted">No file path</span>
                                    } *@

                                    <form asp-action="DeleteDocument"
                                          asp-route-id="@doc.Id"
                                          method="post"
                                          class="d-inline"
                                          onsubmit="return confirm('Are you sure you want to delete this document?');">
                                        <button type="submit" class="btn btn-sm btn-danger">
                                            <i class="fa-solid fa-trash"></i> Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted fst-italic">No documents uploaded</p>
            }
        </div>

    }
    else
    {
        <p class="text-muted text-center mt-4">No documents uploaded</p>
    }
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
